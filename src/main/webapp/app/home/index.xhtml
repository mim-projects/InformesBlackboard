<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:m="http://java.sun.com/jsf/composite/mimsoft/components"
                template="/templates/template_app.xhtml">
    <ui:define name="end_head">
        <h:outputStylesheet library="mimsoft" name="/css/dashboard.css"/>
    </ui:define>
    <ui:define name="container_body">
        <div class="container">
            <div style="display: flex; justify-content: space-between; gap: 2rem; align-items: center; flex-wrap: wrap">
                <h:form id="filters">
                    <div class="filter-group">
                        <p>
                            <i class="pi pi-calendar-times"></i>
                            <span>#{bundle.periods}</span>
                        </p>
                        <p:selectOneMenu value="#{homeCtrl.selectedPeriod}" style="min-width: 8rem !important">
                            <f:selectItem itemValue="#{null}" itemLabel="#{homeCtrl.selectedMonth}" noSelectionOption="true"/>
                            <f:selectItems value="#{homeCtrl.allPeriods}" var="period" itemLabel="#{period}" itemValue="#{period}"/>
                            <p:ajax event="change" update="controls"/>
                        </p:selectOneMenu>
                    </div>
                    <div class="filter-group">
                        <p>
                            <i class="pi pi-calendar"></i>
                            <span>#{bundle.date}</span>
                        </p>
                        <p:selectOneMenu value="#{homeCtrl.selectedMonth}" style="min-width: 8rem !important">
                            <f:selectItem itemValue="#{null}" itemLabel="#{homeCtrl.selectedMonth}" noSelectionOption="true"/>
                            <f:selectItems value="#{homeCtrl.allMonths}" var="month" itemLabel="#{month}" itemValue="#{month}"/>
                            <p:ajax event="change" update="controls"/>
                        </p:selectOneMenu>
                    </div>
                    <div class="filter-group">
                        <p>
                            <i class="pi pi-share-alt"></i>
                            <span>#{bundle.modality}</span>
                        </p>
                        <div class="filter-groups-checkbox">
                            <ui:repeat value="#{homeCtrl.modalityMultiSelectorBooleanListHelper.list}" var="modality">
                                <p:selectBooleanCheckbox value="#{modality.value}" itemLabel="#{modality.model.description}">
                                    <p:ajax event="change" update="controls"/>
                                </p:selectBooleanCheckbox>
                            </ui:repeat>
                        </div>
                    </div>
                    <div class="filter-group">
                        <p>
                            <i class="pi pi-id-card"></i>
                            <span>#{bundle.role}</span>
                        </p>
                        <div class="filter-groups-checkbox">
                            <ui:repeat value="#{homeCtrl.rolesMultiSelectorBooleanListHelper.list}" var="roles">
                                <p:selectBooleanCheckbox value="#{roles.value}" itemLabel="#{roles.model.name}">
                                    <p:ajax event="change" update="controls"/>
                                </p:selectBooleanCheckbox>
                            </ui:repeat>
                        </div>
                    </div>
                </h:form>
                <h:form id="controls">
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem">
                        <p:commandButton value="#{bundle.run}" icon="pi pi-arrow-circle-right" actionListener="#{homeCtrl.applyFilters()}"
                                         disabled="#{homeCtrl.invalidateFilters()}" update="tables"/>
                        <p:commandButton value="#{bundle.report}" icon="pi pi-file-pdf" styleClass="ui-button-warning"
                                         actionListener="#{homeCtrl.createReport()}" ajax="false"
                                         disabled="#{homeCtrl.invalidateFilters()}"/>
                    </div>
                </h:form>
            </div>

            <h:form id="tables">
                <ui:repeat value="#{homeCtrl.allGradesForUI}" var="gradeForUI">
                    <div class="card">
                        <div class="title-card">
                            <div class="title-card-icon-text">
                                <i class="pi pi-users" style="font-size: 1rem !important;"></i>
                                <h1 style="font-size: 1rem !important;">#{bundle.users}. #{gradeForUI.name}</h1>
                            </div>
                        </div>
                        <div class="content-card">
                            <div class="table">
                                <h:outputText escape="false" value="#{homeCtrl.getUsersTableOrGraphic('table', gradeForUI.id)}"/>
                            </div>
                            <div class="graphic">
                                <m:eChartCustom canvasId="cgu#{gradeForUI.id}" data="#{homeCtrl.getUsersTableOrGraphic('graphic', gradeForUI.id)}" height="100%"/>
                            </div>
                        </div>
                    </div>
                </ui:repeat>

                <ui:repeat value="#{homeCtrl.allGradesForUI}" var="gradeForUI">
                    <div class="card">
                        <div class="title-card">
                            <div class="title-card-icon-text">
                                <i class="pi pi-book" style="font-size: 1rem !important;"></i>
                                <h1 style="font-size: 1rem !important;">#{bundle.courses}. #{gradeForUI.name}</h1>
                            </div>
                        </div>
                        <div class="content-card">
                            <div class="table">
                                <h:outputText escape="false" value="#{homeCtrl.getCoursesTableOrGraphic('table', gradeForUI.id)}"/>
                            </div>
                            <div class="graphic">
                                <m:eChartCustom canvasId="cgc#{gradeForUI.id}" data="#{homeCtrl.getCoursesTableOrGraphic('graphic', gradeForUI.id)}" height="100%"/>
                            </div>
                        </div>
                    </div>
                </ui:repeat>
            </h:form>

            <h:form id="storage">
                <div class="card">
                    <div class="title-card">
                        <div class="title-card-icon-text">
                            <i class="pi pi-server" style="font-size: 1rem !important;"></i>
                            <h1 style="font-size: 1rem !important;">#{bundle.storage}</h1>
                        </div>
                    </div>
                    <div class="content-card" style="grid-template-rows: 1fr !important;">
                        <m:eChartCustom data="#{homeCtrl.storageHistory}" height="250px"/>
                    </div>
                </div>
            </h:form>
        </div>
    </ui:define>
</ui:composition>